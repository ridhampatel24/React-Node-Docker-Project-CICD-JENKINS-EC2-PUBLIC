name: React Build and Upload

on:
    workflow_dispatch:
    # push:
    #     branches:
    #         - main

jobs:
    build_and_upload:
        runs-on: ubuntu-latest
        steps:
           - run: echo "${{ secrets.SSH_PRIVATE_KEY }}" > /tmp/id_rsa.pem
           - run: cat /tmp/id_rsa.pem
           - run: chmod 600 /tmp/id_rsa.pem
        #    - run: ssh -o StrictHostKeyChecking=no -i /tmp/id_rsa.pem ubuntu@13.235.83.187

           - name: Checkout code
             uses: actions/checkout@v2

           - name: Set up Node.js
             uses: actions/setup-node@v3
             with:
                node-version: 20
    
          
           

           - name: Install dependencies
             run: cd public && npm install

           - run: pwd && ls
             
           - name: Build React app
             run: cd public && npm run build
           - run: rsync -o StrictHostKeyChecking=no -i /tmp/id_rsa.pem -r public/build/* ubuntu@13.235.83.187:/home/ubuntu/ridham-app/
           - run: rm /tmp/id_rsa.pem
        #    - name: Upload to AWS EC2
        #      uses: appleboy/scp-action@master
        #      with:
        #             host: 13.235.83.187
        #             username: ubuntu
        #             key: ${{ secrets.SSH_PRIVATE_KEY }}
        #             source: public/build/*
        #             target: /home/ubuntu/ridham-app/
